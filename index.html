<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Speed Game</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6eef8;background:linear-gradient(180deg,#071022 0%, #08182e 100%)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:24px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    select,button,input[type=number]{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:#e6eef8;padding:8px 12px;border-radius:8px}
    button.primary{background:linear-gradient(90deg,var(--accent),#5b21b6);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
    .layout{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .prompt{background:rgba(255,255,255,0.02);padding:18px;border-radius:10px;min-height:180px;line-height:1.6;font-size:18px;color:#dbeafe;overflow:auto}
    .prompt .word{padding-right:6px}
    .prompt .correct{color:#86efac}
    .prompt .incorrect{color:#fb7185;text-decoration:underline}
    .input{margin-top:12px;display:flex;gap:8px}
    .input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:#071021;color:#e6eef8;font-size:16px}
    .stats{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:16px;border-radius:10px;color:#cfe7ff}
    .stat{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .stat:last-child{border-bottom:0}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
    @media (max-width:880px){.layout{grid-template-columns:1fr}.stats{order:2}.prompt{order:1}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application">
      <header>
        <h1>Typing Speed Game</h1>
        <div class="controls">
          <label class="small">Time:</label>
          <select id="timeSelect">
            <option value="15">15s</option>
            <option value="30">30s</option>
            <option value="60" selected>60s</option>
            <option value="120">120s</option>
          </select>
          <button id="startBtn" class="primary">Start</button>
          <button id="resetBtn">Reset</button>
        </div>
      </header>

      <div class="layout">
        <div>
          <div class="prompt" id="prompt" aria-live="polite"></div>

          <div class="input">
            <input id="textInput" placeholder="Type here..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" disabled />
            <button id="skipBtn">Skip</button>
          </div>

          <div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button id="newPromptBtn">New Prompt</button>
            <label class="small">Difficulty:</label>
            <select id="difficulty">
              <option value="easy">Easy</option>
              <option value="medium" selected>Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
        </div>

        <aside class="stats">
          <div class="stat"><div><strong id="wpm">0</strong><div class="small">WPM</div></div><div></div></div>
          <div class="stat"><div><strong id="accuracy">100%</strong><div class="small">Accuracy</div></div></div>
          <div class="stat"><div><strong id="timeLeft">60</strong><div class="small">Time left (s)</div></div></div>
          <div class="stat"><div><strong id="charsTyped">0</strong><div class="small">Keystrokes</div></div></div>
          <div class="stat"><div><strong id="correctChars">0</strong><div class="small">Correct chars</div></div></div>
          <div class="stat"><div><strong id="errors">0</strong><div class="small">Errors</div></div></div>
          <div style="padding-top:8px">
            <div class="small">High score (WPM): <strong id="highScore">0</strong></div>
            <div style="margin-top:8px" class="small">Tip: press <kbd>Enter</kbd> to skip word when playing.</div>
          </div>
        </aside>
      </div>

      <footer>
        <div>Built with HTML/CSS/JS â€” Responsive & saves high score locally</div>
        <div><button id="downloadBtn">Export Results</button></div>
      </footer>
    </div>
  </div>

  <script>
  // --- data ---
  const wordPools = {
    easy: `the quick brown fox jumps over the lazy dog this is a simple typing test practice makes perfect keep going`.split(' '),
    medium: (`javascript function variable object array string keyboard timer accuracy speed challenge practice random sentence typing game rapid focus`).split(' '),
    hard: (`synthesis asynchronous juxtaposition paradigm ubiquitous ephemeral obfuscate dichotomy quintessence algorithmic heterogenous quintessential`).split(' ')
  };

  // --- ui ---
  const promptEl = document.getElementById('prompt');
  const inputEl = document.getElementById('textInput');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const skipBtn = document.getElementById('skipBtn');
  const newPromptBtn = document.getElementById('newPromptBtn');
  const timeSelect = document.getElementById('timeSelect');
  const difficultySelect = document.getElementById('difficulty');
  const wpmEl = document.getElementById('wpm');
  const accuracyEl = document.getElementById('accuracy');
  const timeLeftEl = document.getElementById('timeLeft');
  const charsTypedEl = document.getElementById('charsTyped');
  const correctCharsEl = document.getElementById('correctChars');
  const errorsEl = document.getElementById('errors');
  const highScoreEl = document.getElementById('highScore');
  const downloadBtn = document.getElementById('downloadBtn');

  // --- state ---
  let words = [];
  let currentIndex = 0;
  let timer = null;
  let timeLeft = parseInt(timeSelect.value,10);
  let running = false;
  let totalTyped = 0;
  let correctChars = 0;
  let errorCount = 0;
  let startTime = null;

  const HIGH_SCORE_KEY = 'typing_high_score_v1';

  function loadHighScore(){
    const v = localStorage.getItem(HIGH_SCORE_KEY) || '0';
    highScoreEl.textContent = v;
  }

  // generate a prompt using the pool
  function generateWords(difficulty='medium', amount=30){
    const pool = wordPools[difficulty] || wordPools.medium;
    const arr = [];
    for(let i=0;i<amount;i++) arr.push(pool[Math.floor(Math.random()*pool.length)]);
    return arr;
  }

  function renderPrompt(){
    promptEl.innerHTML = '';
    words.forEach((w,i)=>{
      const span = document.createElement('span');
      span.className = 'word';
      span.textContent = w + (i < words.length-1 ? ' ' : '');
      if(i < currentIndex) span.classList.add('correct');
      if(i === currentIndex) span.style.textDecoration = 'underline';
      promptEl.appendChild(span);
    });
    // scroll to current word if overflow
    const curr = promptEl.querySelectorAll('.word')[currentIndex];
    if(curr) curr.scrollIntoView({behavior:'smooth',block:'nearest',inline:'nearest'});
  }

  function resetStats(){
    totalTyped = 0; correctChars = 0; errorCount = 0;
    wpmEl.textContent = '0'; accuracyEl.textContent = '100%';
    charsTypedEl.textContent = '0'; correctCharsEl.textContent = '0'; errorsEl.textContent = '0';
  }

  function startGame(){
    if(running) return;
    running = true;
    timeLeft = parseInt(timeSelect.value,10);
    timeLeftEl.textContent = timeLeft;
    resetStats();
    startBtn.textContent = 'Running...';
    inputEl.disabled = false; inputEl.focus();
    startTime = Date.now();

    timer = setInterval(()=>{
      timeLeft--;
      timeLeftEl.textContent = timeLeft;
      updateMetrics();
      if(timeLeft <= 0){
        stopGame();
      }
    },1000);
  }

  function stopGame(){
    running = false;
    clearInterval(timer);
    startBtn.textContent = 'Start';
    inputEl.disabled = true;
    updateMetrics(true);
    saveHighScore();
  }

  function saveHighScore(){
    const currentWpm = parseInt(wpmEl.textContent,10) || 0;
    const prev = parseInt(localStorage.getItem(HIGH_SCORE_KEY) || '0',10);
    if(currentWpm > prev){
      localStorage.setItem(HIGH_SCORE_KEY, currentWpm);
      highScoreEl.textContent = currentWpm;
      alert('New high score! ' + currentWpm + ' WPM');
    }
  }

  function updateMetrics(final=false){
    const minutes = (parseInt(timeSelect.value,10) - timeLeft) / 60 || 1/60;
    const wpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
    wpmEl.textContent = final ? wpm : Math.max(0,wpm);
    const acc = totalTyped > 0 ? Math.round((correctChars / totalTyped) * 100) : 100;
    accuracyEl.textContent = acc + '%';
    charsTypedEl.textContent = totalTyped;
    correctCharsEl.textContent = correctChars;
    errorsEl.textContent = errorCount;
  }

  // handle input
  inputEl.addEventListener('input', (e)=>{
    const val = e.target.value;
    if(!running) return;
    // compare to current word
    const target = words[currentIndex] || '';
    totalTyped += 1; // count keystroke
    // count correct chars so far in this word
    let correctSoFar = 0;
    for(let i=0;i<val.length;i++) if(val[i] === target[i]) correctSoFar++;
    // errors in this keystroke
    const errorsNow = val.length - correctSoFar;
    // compute delta from previous word state by storing per-word typed? Simpler: recalc correctChars by scanning all typed words tracked.

    // We'll approximate: add correctSoFar difference and error difference.
    // For simplicity maintain correctChars as sum of lengths of all fully correct words plus correctSoFar for current.

    // update display of current word color
    const spans = promptEl.querySelectorAll('.word');
    spans.forEach((s,idx)=>{
      s.classList.remove('incorrect'); s.classList.remove('correct'); s.style.textDecoration = '';
      if(idx < currentIndex) s.classList.add('correct');
      if(idx === currentIndex) s.style.textDecoration = 'underline';
    });
    // highlight current letter by rebuilding the current word span
    const currSpan = spans[currentIndex];
    if(currSpan){
      const frag = document.createDocumentFragment();
      for(let i=0;i<target.length;i++){
        const chSpan = document.createElement('span');
        const typedChar = val[i];
        chSpan.textContent = target[i];
        if(typedChar == null) { /* untouched */ }
        else if(typedChar === target[i]) chSpan.style.color = '#86efac';
        else chSpan.style.color = '#fb7185';
        frag.appendChild(chSpan);
      }
      // replace text
      currSpan.innerHTML = '';
      currSpan.appendChild(frag);
    }

  });

  // handle space or enter to finish word
  inputEl.addEventListener('keydown', (e)=>{
    if(e.key === ' ' || e.key === 'Enter'){
      e.preventDefault();
      if(!running) return;
      const typed = inputEl.value.trim();
      const target = words[currentIndex] || '';
      // count correct chars for this word
      for(let i=0;i<Math.max(typed.length,target.length);i++){
        const a = typed[i] || '';
        const b = target[i] || '';
        totalTyped++;
        if(a === b) correctChars++;
        else errorCount++;
      }
      // mark word correct if exact
      if(typed === target){
        const spans = promptEl.querySelectorAll('.word');
        if(spans[currentIndex]) spans[currentIndex].classList.add('correct');
      } else {
        const spans = promptEl.querySelectorAll('.word');
        if(spans[currentIndex]) spans[currentIndex].classList.add('incorrect');
      }
      currentIndex++;
      inputEl.value = '';
      renderPrompt();
      updateMetrics();
    }
  });

  skipBtn.addEventListener('click', ()=>{
    if(!running) return;
    currentIndex++;
    inputEl.value = '';
    renderPrompt();
  });

  newPromptBtn.addEventListener('click', ()=>{
    words = generateWords(difficultySelect.value, 40);
    currentIndex = 0;
    renderPrompt();
  });

  startBtn.addEventListener('click', ()=> startGame());
  resetBtn.addEventListener('click', ()=>{
    clearInterval(timer);
    running = false; inputEl.disabled = true; inputEl.value=''; currentIndex=0; words = generateWords(difficultySelect.value,40);
    timeLeft = parseInt(timeSelect.value,10); timeLeftEl.textContent = timeLeft; startBtn.textContent='Start'; resetStats(); renderPrompt();
  });

  difficultySelect.addEventListener('change', ()=>{
    words = generateWords(difficultySelect.value,40);
    currentIndex = 0; inputEl.value=''; renderPrompt();
  });

  timeSelect.addEventListener('change', ()=>{
    timeLeft = parseInt(timeSelect.value,10); timeLeftEl.textContent = timeLeft;
  });

  downloadBtn.addEventListener('click', ()=>{
    const data = {
      wpm: wpmEl.textContent,
      accuracy: accuracyEl.textContent,
      time: timeSelect.value,
      date: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'typing_result.json'; a.click(); URL.revokeObjectURL(url);
  });

  // initial setup
  words = generateWords(difficultySelect.value,40);
  timeLeft = parseInt(timeSelect.value,10);
  renderPrompt(); resetStats(); loadHighScore();

  // keyboard shortcut: Enter to start if not running
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' && !running){ startGame(); }
  });
  </script>
</body>
</html>
